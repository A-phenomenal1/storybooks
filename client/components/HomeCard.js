import { useRouter } from "next/router";
import React, { useEffect, useState } from "react";
import { useSelector } from "react-redux";

import styles from "./Header.module.css";

function HomeCard({ story, likeCallbackfn }) {
  const user = useSelector((state) => state.user.users);
  const [noOfLikes, setNoOfLikes] = useState(story.likes || 0);
  const [like, setLike] = useState(false);
  const router = useRouter();

  const onLikeUpdate = async () => {
    let likes = await likeCallbackfn(story.id, !like);
    if (likes !== -1) {
      setNoOfLikes(likes);
      setLike(!like);
    }
  };

  useEffect(() => {
    user.likedContent &&
      setLike(user.likedContent.some((id) => id === story.id));
  }, [user]);

  return (
    <div className={`card ${styles.cardLayout}`}>
      <div className="card-body">
        <div onClick={() => router.push(`/stories/${story.id}`)}>
          <h5 className={`card-title ${styles.cardTitle}`}>{story.title}</h5>
          <p className={`card-text ${styles.cardText}`}>{story.content}</p>
        </div>
        <div className={styles.cardBottom}>
          <span className="fs-6">{noOfLikes} Likes</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="30"
            height="30"
            viewBox="0 0 172 172"
            onClick={onLikeUpdate}
            style={{ fill: like ? "#d0224f" : "#000000" }}
            className={styles.like}
          >
            <path d="M0,172v-172h172v172z" fill="none"></path>
            <path d="M68.8,17.2v25.32969l-15.20957,32.72031h-36.60879l3.88008,40.08574l2.97305,33.01426h23.46523v-8.6h6.24844c3.1998,5.24902 8.80996,8.6 15.0248,8.6h58.92344c6.05528,0 11.52266,-4.40078 12.18613,-10.54844c0.30234,-2.88906 -0.71387,-5.4002 -2.18359,-7.59219c5.01387,-1.76367 8.70078,-6.35762 8.70078,-11.95937c0,-3.05703 -1.32695,-5.64375 -3.11582,-7.85254c4.34199,-2.07441 7.41582,-6.38281 7.41582,-11.49746c0,-3.06543 -1.33535,-5.65215 -3.13262,-7.86934c4.52676,-2.1584 7.67617,-6.73555 7.41582,-12.11895c-0.34434,-7.0127 -6.4584,-12.26172 -13.35352,-12.26172h-49.23164c0.76426,-3.88848 1.56211,-7.97851 2.19199,-11.67383c0.76426,-4.50996 1.31855,-8.26406 1.31855,-10.59883c-0.0084,-6.34922 -1.80566,-12.9168 -4.91309,-18.07344c-3.11582,-5.16504 -7.75176,-9.10391 -13.39551,-9.10391zM73.1,21.5h4.3c3.61133,0 7.06309,2.63711 9.70859,7.02109c2.64551,4.38399 4.2916,10.33848 4.3,15.85625c0,1.55371 -0.50391,5.44219 -1.25976,9.87656c-0.75586,4.44277 -1.73848,9.56582 -2.64551,14.11777l-0.5207,2.57832h54.44707c4.71992,0 8.83516,3.56934 9.06191,8.17168c0.21836,4.46797 -2.92266,8.13809 -7.10508,8.86875l-5.10625,0.89863l4.24961,2.98145c2.21719,1.56211 3.67012,4.10684 3.67012,7.02949c0,4.25801 -3.07383,7.73496 -7.11348,8.44043l-5.10625,0.89863l4.24961,2.98145c2.21719,1.56211 3.67012,4.10684 3.67012,7.02949c0,4.61914 -3.58613,8.30605 -8.14648,8.54121l-5.71934,0.30234l4.50156,3.54414c1.97363,1.54531 3.16621,3.93887 2.87227,6.70195c-0.41152,3.83809 -3.93047,6.71035 -7.91133,6.71035h-58.92344c-5.08105,0 -9.71699,-2.86387 -11.99297,-7.41582l-1.92324,3.11582v-4.3h-7.35703v-55.9h9.03672l16.76328,-36.07969zM21.71836,79.55h21.28164v64.5h-15.23476l-2.62031,-29.10898zM36.55,83.85c-1.18418,0 -2.15,0.96582 -2.15,2.15c0,1.18418 0.96582,2.15 2.15,2.15c1.18418,0 2.15,-0.96582 2.15,-2.15c0,-1.18418 -0.96582,-2.15 -2.15,-2.15zM36.55,92.45c-1.18418,0 -2.15,0.96582 -2.15,2.15c0,1.18418 0.96582,2.15 2.15,2.15c1.18418,0 2.15,-0.96582 2.15,-2.15c0,-1.18418 -0.96582,-2.15 -2.15,-2.15zM36.55,101.05c-1.18418,0 -2.15,0.96582 -2.15,2.15c0,1.18418 0.96582,2.15 2.15,2.15c1.18418,0 2.15,-0.96582 2.15,-2.15c0,-1.18418 -0.96582,-2.15 -2.15,-2.15zM36.55,109.65c-1.18418,0 -2.15,0.96582 -2.15,2.15c0,1.18418 0.96582,2.15 2.15,2.15c1.18418,0 2.15,-0.96582 2.15,-2.15c0,-1.18418 -0.96582,-2.15 -2.15,-2.15zM36.55,118.25c-1.18418,0 -2.15,0.96582 -2.15,2.15c0,1.18418 0.96582,2.15 2.15,2.15c1.18418,0 2.15,-0.96582 2.15,-2.15c0,-1.18418 -0.96582,-2.15 -2.15,-2.15zM36.55,126.85c-1.18418,0 -2.15,0.96582 -2.15,2.15c0,1.18418 0.96582,2.15 2.15,2.15c1.18418,0 2.15,-0.96582 2.15,-2.15c0,-1.18418 -0.96582,-2.15 -2.15,-2.15zM36.55,135.45c-1.18418,0 -2.15,0.96582 -2.15,2.15c0,1.18418 0.96582,2.15 2.15,2.15c1.18418,0 2.15,-0.96582 2.15,-2.15c0,-1.18418 -0.96582,-2.15 -2.15,-2.15z"></path>
          </svg>
        </div>
      </div>
    </div>
  );
}

export default HomeCard;
